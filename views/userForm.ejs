<main class="form-container">
    <h2 class="form-title"><%= locals.user ? 'Edit User' : 'Sign Up' %></h2>

    <% if (typeof error !== 'undefined') { %>
        <p class="form-error"><%= error %></p>
    <% } %>

    <form action="<%= locals.user ? '/auth/user/' + locals.user.user_id + '/edit' : '/register' %>" class="user-form" method="POST">
        <div class="form-group">
            <label for="name">Name</label>
            <input 
                type="text" 
                name="name" 
                id="name"
                value="<%= locals.user ? locals.user.name : '' %>"
                required 
                placeholder="<%= locals.user ? locals.user.name : 'Enter your full name' %>"
            />
        </div>
        
        <div class="form-group">
            <label for="email">Email</label>
            <input 
                type="email" 
                name="email" 
                id="email" 
                value="<%= locals.user ? locals.user.email : '' %>"
                required 
                placeholder="<%= locals.user ? locals.user.email : 'you@example.com' %>"
                <%= locals.user ? 'readonly' : '' %>
            />
        </div>

        <div class="form-group">
            <label for="password">Password</label>
            <input 
                type="password"
                name="password" 
                id="password" 
                required 
                placeholder="<%= locals.user ? 'Enter new password' : 'Create a password' %>"
            />      
        </div>

        <div class="form-group">
            <label for="phone_number">Phone</label>
            <input 
                type="tel" 
                name="phone_number" 
                id="phone_number"
                value="<%= locals.user ? locals.user.phone_number : '' %>"
                pattern="^\+?[\d\s\-\(\)]{7,15}$"
                placeholder="<%= locals.user ? locals.user.phone_number : '(555) 123-4567' %>"
            />
        </div>

        <div class="form-group">
            <label for="about">About You</label>
            <textarea 
                name="about" 
                id="about" 
                rows="3" 
                placeholder="<%= locals.user ? locals.user.about : 'Tell us something about yourself!' %>"><%= locals.user ? locals.user.about : '' %></textarea>
        </div>

        <div class="form-group">
            <label for="favorite_book">Favorite Book</label>
            <select name="favorite_book_id" id="favorite_book_id">
                <option value="" disabled <%= locals.user && !locals.user.favorite_book_id ? 'selected' : '' %>>Select a book</option>
                <% if (locals.books) { %>
                    <% locals.books.forEach(book => { %>
                        <option value="<%= book.book_id %>" <%= locals.user && locals.user.favorite_book_id === book.book_id ? 'selected' : '' %>><%= book.title %></option>
                    <% }) %>
                <% } else { %>
                    <option value="" disabled>No books available</option>
                <% } %>
            </select>
        </div>

        <input type="hidden" name="user_color" value="<%= locals.user ? locals.user.user_color : '' %>">

        <div class="form-group">
            <label for="user_color">Dashboard Theme</label>
            <div class="theme-grid">
                <% const colors = ['pastel-blue', 'pastel-green', 'pastel-yellow', 'pastel-pink', 'pastel-purple', 'pastel-orange', 'pastel-red', 'pastel-gray', 'pastel-brown']; %>
                <% colors.forEach(color => { %>
                    <label class="theme-box <%= color %>">
                        <input 
                            type="radio" 
                            name="user_color" 
                            value="<%= color %>" 
                            <%= locals.user && locals.user.user_color === color ? 'checked' : '' %>
                        />
                    </label>
                <% }) %>
            </div> 
        </div>

        <button type="submit" class="btn btn-primary btn-center"><%= locals.user ? 'Save Changes' : 'Sign Up' %></button>
    </form>

    <% if (locals.user) { %>
        <form action="/auth/user/<%= locals.user.user_id %>/delete" method="POST" onsubmit="return confirm('Are you sure you want to delete this user? This action cannot be undone.');">
            <button type="submit" class="btn btn-danger btn-center">Delete User</button>
        </form>
    <% } %>

    <% if (!locals.user) { %>
        <p class="form-footer-text">
            Already have an account? <a href="/login">Login here</a>
        </p>
    <% } %>
</main>